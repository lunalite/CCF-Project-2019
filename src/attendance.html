<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="./style/style.css">
  <title>CCF Attendance</title>
</head>
<body>
<div class="sidenav">
  <a href="index.html">Dashboard</a>
  <a href="attendance.html">Take Attendance</a>
  <a href="manage.html">Manage Students</a>
</div>
<div class="main">
  <div id="header-information"></div>
  <div id="student-display"></div>
</div>

<script>
    let [_, studentClass, day] = window.location.search.match('class=(.+)&day=(.+)');
    let headerInformation = '';

    headerInformation += `Class: ${studentClass}`;
    headerInformation += '<br>';
    headerInformation += `Day: ${day}`;
    headerInformation += '<hr>';

    let headerInformationElement = document.getElementById("header-information");
    headerInformationElement.innerHTML = headerInformation;

    let oReq = new XMLHttpRequest();
    oReq.open("GET", "https://jsonplaceholder.typicode.com/users", true);
    oReq.onload = function () {
        const responseJson = JSON.parse(this.response);
        let template = '';
        template += '<table border="1">';
        template += '<tr>';
        template += '<th>ID</th>';
        template += '<th align="left">Name</th>';
        template += `<th>Attendance</th>`;
        template += '</tr>';
        for (const item of responseJson) {
            template += '<tr>';
            template += `<td>${item['id']}</td>`;
            template += `<td>${item['name']}</td>`;
            template += '<td align="center">';
            template += `<input type="checkbox" name="attendance" value="${item['id']}"/>`;
            template += '</td>';
            template += '</tr>';
        }
        template += '</table>';
        template += '<input type="submit" value="update" onclick="updateAttendance()"/>';
        document.getElementById("student-display").innerHTML = template
    };
    oReq.send();

    function updateAttendance() {
        let attendance = document.getElementsByName("attendance");
        let data = [];
        for (const item of attendance) {
            data.push({id: item.value, present: item.checked});
        }

        oReq.open('POST', 'https://nonexistent.link', true);
        oReq.timeout = 1;
        oReq.setRequestHeader('Content-type', 'application/json; charset=utf-8');
        oReq.onload = function () {
            let replacement = window.location.href.split('/').slice(-1);
            window.location.href = window.location.href.replace(replacement, '');
        };
        oReq.send(JSON.stringify(data))
    }
</script>
</body>
</html>
